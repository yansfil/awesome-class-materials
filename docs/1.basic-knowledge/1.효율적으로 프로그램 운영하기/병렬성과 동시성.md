# 병렬성과 동시성

우리는 컴퓨터를 사용할 때 여러 프로그램을 실행시켜둔 채 사용합니다. 예를 들어 저는 현재 크롬 브라우저에서 유튜브 음악을 들으며 카카오톡을 켜두고 텍스트 에디터로 글을 쓰고있습니다. 이 모든 것들이 한번에 일어나고 있습니다.

이번 글에서는 컴퓨터가 어떻게 한번에 여러 프로세스들의 작업을 수행하는지에 대한 개념과 방식을 다룹니다.

## 동시성

![img](http://tutorials.jenkov.com/images/java-concurrency/concurrency-vs-parallelism-1.png)

(출처: http://tutorials.jenkov.com/java-concurrency/concurrency-vs-parallelism.html)

컴퓨터의 구성요소 중 하나인 CPU(Central Processing Unit)는 말 그대로 컴퓨터 중심부에서 컴퓨터 명령을 처리하는 역할을 합니다. 우리가 컴퓨터를 사용하며 내리는 명령들, 예를 들어 "크롬 브라우저를 실행해줘"를 바로 이 CPU가 처리하는 것이죠.

컴퓨터가 발전하던 초기에는 컴퓨터 하나당 CPU가 하나였습니다. CPU가 하나이니 한 번에 처리할 수 있는 명령도 하나였습니다. 따라서 여러 개의 명령어, 여러 프로세스를 실행하려면 시간이 오래 걸렸습니다. 이 속도를 좀 더 개선하고자하는 필요성이 떠오르기 시작합니다.

이 속도를 개선하고자 기존 작업의 CPU 사용량을 보니, CPU 사용량이 매우 낮다는 것을 발견했습니다. 예를 들어 어떤 작업이 1분이 걸린다고 하면, 그 중 10초만 CPU를 사용하고 나머지 50초는 I/O를 하는데에 사용하는 것이었습니다. 이 50초 동안 CPU는 아무것도 하지 않고 기다리게 됩니다. (이를 CPU가 블락 상태에 있다고 합니다.)

만약 이 50초 동안 가만히 있는 CPU를 그 다음에 수행되어야 할 작업이 바로 사용하게끔 만들어준다면, 전체적으로 작업 속도가 더 빨라질 거 같습니다. 즉 CPU가 가만히 있지 않도록 최대한 활용하도록 하는 것입니다.

**이러한 아이디어는 운영체제에서 구현되어, 이제 하나의 CPU를 최대한 활용하여 여러 작업들을 빠르게 수행합니다.** 여전히 CPU는 한번에 하나의 명령어만 처리하지만, CPU가 Block 상태가 되면 빠르게 다음에 처리해야할 프로세스가 CPU를 점유하여 사용하게 됩니다. (CPU 입장에서는 매번 여러 프로세스를 번갈아 가며 자신의 메모리에 불러오는 셈인데, 이렇게 CPU가 작업해야할 프로세스를 바꾸는 일을 "컨텍스트 스위칭"이라고 합니다.)

CPU를 점유하는 프로세스를 빠르게 바뀌고, 명령들도 빠르게 처리되다 보니 컴퓨터 사용자는 사실상 모든 프로세스의 명령이 "동시에" 처리된다고 느끼게 됩니다. 사실은 여전히 CPU는 1개에, 여러 프로세스를 컨텍스트 스위칭하며 한 번에 하나의 명령을 처리하고 있음에도 말이죠. 이렇게 진행되는 현상을 우리는 `동시성(Concurrency)`이라고 부릅니다.


### CPU Bound vs I/O Bound
 컴퓨터가 수행하는 하나의 작업은 CPU와 I/O 작업로 이루어집니다. 이 때 컴퓨터 작업을 크게 2가지로 나눠볼 수 있습니다. 하나는 `CPU Bounded Task` 이고, 다른 하나는 `I/O Bounded Task` 입니다.

 CPU Bounded Task는 작업을 실행하는데 I/O보다는 CPU를 더 많이 쓰는 작업을 말합니다. 예를 들면 머신 러닝과 같이 연산이 복잡한 로직이 여기에 해당합니다. I/O 작업이 아예 없는 것은 아니지만, 대체로 CPU 사용량이 더 압도적입니다.

 I/O Bounded Task는 작업을 실행하는데 CPU보다는 I/O가 더 많은 작업을 말합니다. 예를 들면 크롤링 로직, DB와 연결하여 데이터를 주고받는 로직 등이 여기에 해당합니다. 일반적으로 웹, WAS 서버는 I/O Bounded한 경우가 많습니다. 

## 병렬성

컴퓨터 하드웨어는 점점 발전하여, 이제 컴퓨터 하나당 2개 이상의 CPU를 가질 수 있게 되었습니다. CPU가 2개이므로 이제 우리는 동시에 2개의 명령어를 실행할 수 있습니다. **이렇게 여러 개의 작업을 동시에 진행되는 현상을 `병렬성(Parallelism)`이라고 부릅니다.**

위에서 "동시성"은 실제로는 하나의 명령을 빠르게 수행하지만 처리속도가 매우 빨라 여러 작업이 동시에 진행되는 것처럼 "느껴지게" 해주었다면, 병렬성은 "실제로" 여러 개의 명령어를 동시에 실행하는 것입니다. 물론 운영체제가 여러 CPU를 골고루 쓰도록 매니징해줍니다.

![img](http://tutorials.jenkov.com/images/java-concurrency/concurrency-vs-parallelism-2.png)

(출처: http://tutorials.jenkov.com/java-concurrency/concurrency-vs-parallelism.html)

병렬성은 CPU를 2개 이상 사용하므로, 일반적으로 동시성보다 성능이 좋습니다.
또한 병렬성은 동시성을 품을 수도 있습니다. 여러 개의 CPU를 사용하면서 각각의 CPU에서는 동시성을 구현하는 것이죠.

## 정리
- 동시성(Concurrency)은 하나의 CPU로 여러 작업을 빠르게 처리하는 것입니다.
    - 여러 작업이 한번에 실행되는 것처럼 보이지만, 실제로는 하나의 CPU에서 처리하고 있는 것입니다.
    - 이 외에도 이벤트 루프 등으로 구현할 수 있습니다. 이에 대한 내용은 검색해보시면 좋을거 같습니다.
- 병렬성(Parallelism)은 여러 개의 CPU로 여러 작업을 빠르게 처리하는 것입니다.
    - 여러 작업이 실제로 여러 개의 CPU를 통해 한번에 처리 됩니다.